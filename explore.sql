--- Average Order Value (AOV)  
SELECT
	ROUND(AVG(TRANSACTIONAMOUNT))
FROM
	PUBLIC.SALES;


-- Average num of orders per customer
WITH
	NUM_ORDERS_PER_CUSTOMER AS (
		SELECT
			CUSTOMERID,
			COUNT(DISTINCT TRANSACTIONID) NUM_ORDERS
		FROM
			PUBLIC.SALES
		GROUP BY
			CUSTOMERID
	)
SELECT
	ROUND(AVG(NUM_ORDERS))
FROM
	NUM_ORDERS_PER_CUSTOMER;


-- Avg shipping cost
SELECT
	ROUND(AVG(SHIPPINGCOST))
FROM
	PUBLIC.SALES;

-- Returns
SELECT
	PRODUCTNAME,
	COUNT(*) RETURNED
FROM
	PUBLIC.SALES
WHERE
	RETURNED = TRUE
GROUP BY
	1;



-- discount %
SELECT
	CASE
		WHEN LOYALTYPOINTS BETWEEN 0 AND 1000  THEN '0-1000'
		WHEN LOYALTYPOINTS BETWEEN 1001 AND 2000  THEN '1001-2000'
		WHEN LOYALTYPOINTS BETWEEN 2001 AND 3000  THEN '2001-3000'
		WHEN LOYALTYPOINTS BETWEEN 3001 AND 4000  THEN '3001-4000'
		WHEN LOYALTYPOINTS BETWEEN 4001 AND 5000  THEN '4001-5000'
		WHEN LOYALTYPOINTS BETWEEN 5001 AND 6000  THEN '5001-6000'
		WHEN LOYALTYPOINTS BETWEEN 6001 AND 7000  THEN '6001-7000'
		WHEN LOYALTYPOINTS BETWEEN 7001 AND 8000  THEN '7001-8000'
		WHEN LOYALTYPOINTS BETWEEN 8001 AND 9000  THEN '8001-9000'
		WHEN LOYALTYPOINTS BETWEEN 9001 AND 10000  THEN '9001-10000'
		ELSE 'NA'
	END AS LOYALTY_POINTS,
	AVG(DISCOUNTPERCENT)
FROM
	PUBLIC.SALES
GROUP BY
	1

	
	-- Split of promotional vs non promotional 
SELECT
	ISPROMOTIONAL,
	COUNT(TRANSACTIONID)
FROM
	PUBLIC.SALES
GROUP BY
	1